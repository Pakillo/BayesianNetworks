<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit bipartite network model — fit_model • BayesianWebs</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit bipartite network model — fit_model"><meta name="description" content="Fit bipartite network model"><meta property="og:description" content="Fit bipartite network model"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesianWebs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Pakillo/BayesianWebs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit bipartite network model</h1>
      <small class="dont-index">Source: <a href="https://github.com/Pakillo/BayesianWebs/blob/HEAD/R/fit_model.R" class="external-link"><code>R/fit_model.R</code></a></small>
      <div class="d-none name"><code>fit_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit bipartite network model</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_model</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plant_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"data"</span><span class="op">)</span>,</span>
<span>  animal_pref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed"</span>, <span class="st">"varying"</span><span class="op">)</span>,</span>
<span>  plant_abun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"data"</span><span class="op">)</span>,</span>
<span>  animal_abun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"param"</span>, <span class="st">"data"</span><span class="op">)</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  alpha_sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alpha_tau <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A named list containing the required data, as obtained from
<code><a href="prepare_data.html">prepare_data()</a></code>.</p></dd>


<dt id="arg-plant-effort">plant_effort<a class="anchor" aria-label="anchor" href="#arg-plant-effort"></a></dt>
<dd><p>How to model the sampling effort allocated to each plant. If unknown, <code>"param"</code> (default) estimates a single parameter during the modelling step that applies to all plants, \(C\). Alternatively, <code>"data"</code> allows measured values of sampling effort to be supplied in <code>data</code>, \(C_i\).</p></dd>


<dt id="arg-animal-pref">animal_pref<a class="anchor" aria-label="anchor" href="#arg-animal-pref"></a></dt>
<dd><p>How to model the increase in visits of animals to plants with which they share a link relative to unlinked plants. <code>"fixed"</code> (default), fits a single preference parameter for all animals during the modelling step, \(r\). <code>"varying"</code> fits a separate preference parameter for each animal type, \(r_i\).</p></dd>


<dt id="arg-plant-abun">plant_abun<a class="anchor" aria-label="anchor" href="#arg-plant-abun"></a></dt>
<dd><p>How the model treats the abundances of interacting plants. <code>"param"</code> (default) treats these abundances as a parameter that the model estimates, \(\sigma_i\). <code>"data"</code> treats these abundances as measured and requires the user to supply the absolute abundances of each plant in <code>data</code>.</p></dd>


<dt id="arg-animal-abun">animal_abun<a class="anchor" aria-label="anchor" href="#arg-animal-abun"></a></dt>
<dd><p>How the model treats the abundances of interacting animals. <code>"param"</code> (default) treats these abundances as a parameter that the model estimates, \(\tau_i\). <code>"data"</code> treats these abundances as measured and requires the user to supply the absolute abundances of each animal in <code>data</code>.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>Rate parameter of exponential prior on the preference parameter or parameters \(r\) or \(r_i\). The default, 0.01, is suitable for small counts and should be increased for larger counts. Use <code><a href="plot_prior.html">plot_prior()</a></code> to visualize.</p></dd>


<dt id="arg-alpha-sigma">alpha_sigma<a class="anchor" aria-label="anchor" href="#arg-alpha-sigma"></a></dt>
<dd><p>Vector of concentration parameters for Dirichlet prior on the relative abundances of interacting plants, \(\sigma_i\), when <code>plant_abun = "param"</code>. Ignored otherwise. Defaults to 1.</p></dd>


<dt id="arg-alpha-tau">alpha_tau<a class="anchor" aria-label="anchor" href="#arg-alpha-tau"></a></dt>
<dd><p>Concentration parameters of Dirichlet prior on the relative abundances of interacting plants, \(\tau_i\), when <code>animal_abun = "param"</code>. Ignored otherwise. Defaults to 1.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>, like <code>iter_warmup</code>,
<code>iter_sampling</code>, or <code>thin</code>, among others.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A fitted model (<code><a href="https://mc-stan.org/cmdstanr/reference/CmdStanMCMC.html" class="external-link">cmdstanr::CmdStanMCMC()</a></code> object).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function allows fits generalized variations of the bipartite network structure model of Young et al. 2021 <a href="https://doi.org/10.1038%2Fs41467-021-24149-x" class="external-link"></a><a href="doi:10.1038/s41467-021-24149-x">doi:10.1038/s41467-021-24149-x</a>. Briefly, the observed interaction count between each plant and animal pair is treated as a random draw from a Poisson distribution with a mean of:
$$\mu_{ij} = C_i\sigma_i\tau_j\left(1 + r_iB_{ij}\right).$$
Here, the subscripts \(i\) and \(j\) are indices that correspond to the plant (row) and animal (column) species, respectively. \(C_i\) is the observer's sampling effort allocated to each plant species; we expect to see more interactions with plants the longer they are observed. \(\sigma_i\) and \(\tau_i\) are the relative contributions of each plant and animal to the total pool of interactions. We expect to observe higher interaction counts for species that contribute most to the interactions made by their guild. The observed interaction count should be compounded when species of both guilds are those that are most interactive. Importantly, these terms capture more than just each species' relative abundances in the their guild. An animal that is highly active but numerically rare animal could have a higher \(\tau_i\) than a numerically dominant, but less active animal. \(r_i\) is the increase in visits of animals to plants with which they share a link relative to unlinked plants, and \(B_{ij}\) is the inferred absence (0) or presence (1) of a link between the plant-animal pair.</p>
<p><b>Prior distributions</b></p>
<p>The default priors are very weak to accommodate a wide range of empirical datasets. They may fail for exceptional datasets and they do not capture system-specific prior information that users may have from additional data.</p>
<p>The animal preference parameter, \(r_i\), has an exponential prior with a rate parameter <code>beta</code>. The default, \(\mathrm{exp}(0.01)\), implies a mean of 1/0.01 = 100 with 95% of the probability mass falling between about 2.5-370. Increase <code>beta</code> for animal communities that weakly increase visitation in the presence of a link, or decrease for communities that strongly increase visitation in the presence of a link.</p>
<p>The relative interaction abundances for plants, \(\sigma_i\), has a Dirichlet prior that accepts a vector of concentration parameters, <code>alpha_sigma</code>, with a length equal to the number of plant species (rows) in the interaction matrix. The default, \(\mathrm{Dir}(1, ..., 1)\), implies a uniform distribution of proportions. Increasing some of the concentration parameters will shift the probability mass to favor higher relative interaction abundances for the corresponding plants. Increasing all concentration parameters while maintaining their relative sizes reduces the variance.</p>
<p>The relative interaction abundances for animals, \(\tau_j\), has a Dirichlet prior that accepts a vector of concentration parameters, <code>alpha_tau</code>, with a length equal to the number of animal species (columns) in the interaction matrix. The default, \(\mathrm{Dir}(1, ..., 1)\), implies a uniform distribution of proportions. Increasing some of the concentration parameters will shift the probability mass to favor higher relative interaction abundances for the corresponding animals Increasing all concentration parameters while maintaining their relative sizes reduces the variance.</p>
<p>At this time, prior choices have not been implemented for sampling effort, \(C_i\), when <code>plant_effort = "param"</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># interactive()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">web</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_data.html">prepare_data</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">web</span>, plant_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">web</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># fit the model used by Young et al. 2021</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_model</span><span class="op">(</span><span class="va">dt</span>, plant_effort <span class="op">=</span> <span class="st">"param"</span>, animal_pref <span class="op">=</span> <span class="st">"fixed"</span>,</span></span>
<span class="r-in"><span>                 plant_abun <span class="op">=</span> <span class="st">"param"</span>, animal_abun <span class="op">=</span> <span class="st">"param"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># changing options and priors</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">fit_model</span><span class="op">(</span><span class="va">dt</span>, plant_effort <span class="op">=</span> <span class="st">"data"</span>, animal_pref <span class="op">=</span> <span class="st">"varying"</span>,</span></span>
<span class="r-in"><span>                  plant_abun <span class="op">=</span> <span class="st">"param"</span>, animal_abun <span class="op">=</span> <span class="st">"param"</span>,</span></span>
<span class="r-in"><span>                  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">21</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  alpha_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  alpha_tau <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Francisco Rodriguez-Sanchez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

